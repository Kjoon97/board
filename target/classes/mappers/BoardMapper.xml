<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lottetour.web.mapper.BoardMapper">
	<insert id="insert">
    	INSERT INTO KJH_Board 
    	(ID, TITLE, CONTENT, PASSWD, SALT, USERID, UPDATEDATE, REGDATE, DELETEDATE)
    	VALUES
    	(SEQ_BOARD.NEXTVAL, #{title}, #{content}, #{passwd}, #{salt}, #{userId}, SYSDATE, SYSDATE, TO_CHAR(#{deleteDate}, 'YYYY-MM-DD'))
	</insert>

	<select id="selectByid" resultType="com.lottetour.web.domain.BoardVO">
		SELECT * FROM KJH_Board 
		WHERE ID =#{id}
	</select>


	<update id="update" parameterType="BoardVO">
		UPDATE KJH_Board
		SET TITLE =#{title,jdbcType=VARCHAR}, CONTENT =#{content,jdbcType=VARCHAR},
		USERID =#{userId,jdbcType=VARCHAR}, DELETEDATE = TO_CHAR(#{deleteDate}, 'YYYY-MM-DD'), UPDATEDATE = SYSDATE
		WHERE id =#{id}
	</update>
	
	<update id="changeIsDeleted" parameterType="BoardVO">
		UPDATE KJH_Board
		SET IS_DELETED = 1, UPDATEDATE = SYSDATE
		WHERE ID =#{id}
	</update>

	<delete id="delete">
		DELETE FROM KJH_Board 
		WHERE ID = #{id}
	</delete>

	<update id="updateviewcount">
		UPDATE KJH_BOARD 
		SET VIEWCOUNT= VIEWCOUNT+1 
		WHERE ID =#{id}
	</update>

	<select id="selectAll" resultType="com.lottetour.web.domain.BoardVO">
    	<![CDATA[
        	SELECT * FROM KJH_Board
        	ORDER BY ID ASC
    	]]>
	</select>

	<!-- <sql>코드는 <include>로 사용할 수 있음 -->
	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<choose>
				<when test="type == 'T'.toString()">
					TITLE LIKE '%'||#{keyword}||'%'
				</when>
				<when test="type == 'C'.toString()">
					CONTENT LIKE '%'||#{keyword}||'%'
				</when>
				<when test="type == 'W'.toString()">
					USERID LIKE '%'||#{keyword}||'%'
				</when>
			</choose>
		</trim>
	</sql>



	<select id="getListWithPaging" resultType="com.lottetour.web.domain.BoardVO">
	<![CDATA[
		SELECT * FROM(
			SELECT ROWNUM AS RNUM, A.* FROM (
				SELECT * FROM KJH_BOARD
				WHERE IS_DELETED = 0
				ORDER BY REGDATE DESC 
			) A WHERE
		]]>
		<include refid="criteria"></include>
		<![CDATA[
			 ROWNUM <=#{pageNum}*#{amount}
		) WHERE RNUM > (#{pageNum}-1)*#{amount}
		]]>
	</select>



	<select id="getTotalCount" resultType="int">
    	<![CDATA[
    		SELECT COUNT(*) FROM KJH_BOARD WHERE
    	]]>
		<include refid="criteria"></include>
    	<![CDATA[
    		 ID > 0 AND IS_DELETED=0
		]]>
	</select>
	
	<update id="deleteListBySchedule">
		UPDATE KJH_Board
		SET IS_DELETED = 1, UPDATEDATE = SYSDATE
		WHERE TO_CHAR(deleteDate, 'YYYY-MM-DD') = TO_DATE(#{dateString})
	</update>
	
	<resultMap id="BoardResultMap" type="com.lottetour.web.domain.BoardVO">
        <result property="id" column="ID"/>
        <result property="title" column="TITLE"/>
        <result property="content" column="CONTENT"/>
        <result property="regDate" column="REGDATE"/>
        <result property="updateDate" column="UPDATEDATE"/>
        <result property="deleteDate" column="DELETEDATE"/>
        <result property="userId" column="USERID"/>
        <result property="viewCount" column="VIEWCOUNT"/>
        <result property="isDeleted" column="IS_DELETED"/>
        <result property="passwd" column="PASSWD"/>
        <result property="salt" column="SALT"/>
    </resultMap>
	
	<!-- 패키지 프로시저 호출 매핑 -->
    <select id="getBoardByProc" statementType="CALLABLE">
    	{ call BOARD_PACKAGE.GET_BOARD(
    			#{p_id, mode=IN, jdbcType=INTEGER}, 
    			#{p_result, mode=OUT, jdbcType=CURSOR, javaType=java.sql.ResultSet, resultMap=BoardResultMap}) }
	</select>

</mapper>  